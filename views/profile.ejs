<%- include('templates/headerHamburgerOnly') %>
    <header class="text-white text-6xl text-center m-10 mt-32">
        <%= user.username %>'s Profile
    </header>

    <form class="w-[70%] mx-auto bg-[#EAD797] flex flex-col justify-center p-10 text-[#515F84] rounded-xl gap-5"
        id="profileForm" method="POST" action="/updateProfile">
        <input type="hidden" name="_method" value="PUT">
        <div>
            <label for="username" class="text-xl">Username</label>
            <input id="username" type="text" name="username" value="<%= user.username %>"
                class="block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                disabled>
        </div>
        <div>
            <label for="email" class="text-xl">Email</label>
            <input id="email" type="email" name="email" value="<%= user.email %>"
                class="block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                disabled>
        </div>
        <div>
            <label for="location" class="text-xl">Address</label>
            <input id="location" type="text" name="location" value="<%= user.defaultLocation %>"
                class="block w-full rounded-md border-0 py-1.5 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                disabled>
        </div>
        <div class="w-full flex flex-row justify-between align-center text-white">
            <button type="button" id="editBtn" onclick="toggleEdit()"
                class="bg-indigo-500 rounded-xl px-4 py-2">Edit</button>
            <button type="submit" id="saveBtn" class="bg-[#515F84] rounded-xl px-4 py-2" disabled>Save</button>
        </div>
    </form>

    <script>
        function toggleEdit() {
            const editBtn = document.getElementById('editBtn');
            const username = document.getElementById('username');
            const email = document.getElementById('email');
            const location = document.getElementById('location');
            const saveBtn = document.getElementById('saveBtn');

            const isEditing = editBtn.innerText === "Edit";
            editBtn.innerText = isEditing ? "Cancel" : "Edit";
            username.disabled = !username.disabled;
            email.disabled = !email.disabled;
            location.disabled = !location.disabled;
            saveBtn.disabled = !saveBtn.disabled;
        }

        document.getElementById('profileForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const usernameField = document.getElementById('username');
            const emailField = document.getElementById('email');
            const locationField = document.getElementById('location');

            const updatedUser = {
                username: usernameField.value,
                email: emailField.value,
                location: locationField.value
            };

            try {
                const response = await fetch('/updateProfile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedUser),
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Success:', data);
                    // Optionally update the UI or notify the user of success
                    location.reload(); // Reload the page to reflect the updated data
                } else {
                    console.error('Error:', response.statusText);
                    // Optionally notify the user of an error
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
    <%- include('templates/footer') %>