<%- include('templates/header') %>
    <style>
        .hidden {
            display: none;
        }
    </style>

    <!-- Title -->
    <div class="flex justify-center mt-28 mb-14">
        <h1 class="font-bold text-white text-4xl">Surveillance Drones</h1>
    </div>

    <!-- Sort button with dropdown menu -->
    <div class="sort-options">
        <button id="sort" class="bg-white px-2 rounded-full ms-4">
            <span class="font-bold text-gray-700 pt-1 material-symbols-outlined">Sort</span>
        </button>

        <!-- Sort options dropdown -->
        <div id="sort-options-container" class="hidden bg-white p-3 mx-4 text-center rounded-lg">
            <button value="manufacturer" onclick="sortItems('manufacturer')">Manufacturer</button><br>
            <button value="type" onclick="sortItems('type')">Type</button><br>
            <button value="price-asc" onclick="sortItems('price-asc')">Price: Low to High</button><br>
            <button value="price-desc" onclick="sortItems('price-desc')">Price: High to Low</button><br>
        </div>
    </div>

    <!-- Filter button -->





    <!-- Drones list -->
    <div id="drones-list" class="flex flex-wrap items-center">
        <% drones.forEach(function(drone) { %>
            <div class="item m-4 w-full bg-white h-full shadow-lg rounded-lg overflow-hidden text-center"
                data-manufacturer="<%= drone.manufacturer %>" data-type="<%= drone.type %>"
                data-price="<%= drone.price %>">
                <div class="p-6 flex justify-between flex-col">
                    <h2 class="tracking-widest text-xs title-font font-medium text-gray-500 mb-1">Model</h2>
                    <h1 class="title-font text-lg font-medium text-gray-900 mb-3">
                        <%= drone.model %>
                    </h1>
                    <h2 class="tracking-widest text-xs title-font font-medium text-gray-500 mb-1">Manufacturer</h2>
                    <p class="leading-relaxed mb-3">
                        <%= drone.manufacturer %>
                    </p>
                    <h2 class="tracking-widest text-xs title-font font-medium text-gray-500 mb-1">Price</h2>
                    <p class="leading-relaxed mb-3">
                        $<%= drone.price %> / month
                    </p>
                    <h2 class="tracking-widest text-xs title-font font-medium text-gray-500 mb-1">Type</h2>
                    <p class="leading-relaxed mb-3">
                        <%= drone.type %>
                    </p>
                    <button type="button" data-modal-toggle="drone-modal"
                        class="flex bg-cyan-600 px-4 py-2 mt-2 mx-12 justify-center text-white font-bold rounded-full">Place
                        an Order</button>
                </div>
            </div>
            <% }); %>
    </div>

    <%- include('templates/modal', { modalId: 'drone-modal' , description: '(model description)' }) %>
        <%- include('templates/footer') %>

            <script>

                // Sort button click opens sort options
                document.getElementById('sort').addEventListener('click', function () {
                    const sortOptionsContainer = document.getElementById('sort-options-container');
                    if (sortOptionsContainer.classList.contains('hidden')) {
                        sortOptionsContainer.classList.remove('hidden');
                    } else {
                        sortOptionsContainer.classList.add('hidden');
                    }
                });

                let sortOrder = {
                    manufacturer: 'asc',
                    type: 'asc'
                };

                // Sort items based on selected criteria
                function sortItems(criteria) {
                    console.log(`Sorting by: ${criteria}`);
                    const items = document.querySelectorAll('.item');
                    const itemsArray = Array.from(items);
                    itemsArray.sort((a, b) => {
                        let aValue, bValue;
                        switch (criteria) {
                            case 'manufacturer':
                                aValue = a.dataset.manufacturer.toLowerCase();
                                bValue = b.dataset.manufacturer.toLowerCase();
                                break;
                            case 'type':
                                aValue = a.dataset.type.toLowerCase();
                                bValue = b.dataset.type.toLowerCase();
                                break;
                            case 'price-asc':
                                aValue = parseFloat(a.dataset.price);
                                bValue = parseFloat(b.dataset.price);
                                return aValue - bValue;
                            case 'price-desc':
                                aValue = parseFloat(a.dataset.price);
                                bValue = parseFloat(b.dataset.price);
                                return bValue - aValue;
                        }
                        if (sortOrder[criteria] === 'asc') {
                            if (aValue < bValue) return -1;
                            if (aValue > bValue) return 1;
                        } else {
                            if (aValue < bValue) return 1;
                            if (aValue > bValue) return -1;
                        }
                        return 0;
                    });

                    if (criteria === 'manufacturer' || criteria === 'type') {
                        // Toggle sort order for manufacturer and type (asc/desc)
                        sortOrder[criteria] = sortOrder[criteria] === 'asc' ? 'desc' : 'asc';
                    }

                    // Hide the sort options
                    document.getElementById('sort-options-container').classList.add('hidden');

                    // display sorted items
                    const container = document.getElementById('drones-list');
                    container.innerHTML = '';
                    itemsArray.forEach(item => container.appendChild(item));
                }


                // Custom JavaScript to handle modal toggle
                document.addEventListener('DOMContentLoaded', function () {
                    const modalToggleButtons = document.querySelectorAll('[data-modal-toggle]');
                    const modalHideButtons = document.querySelectorAll('[data-modal-hide]');
                    const modals = document.querySelectorAll('.hidden');
                    const modalBody = document.getElementById('modal-body');
                    const modalFooter = document.getElementById('modal-footer');
                    const bookNowButton = document.getElementById('book-now-button');
                    const orderButton = document.getElementById('order-button');
                    const homeButton = document.getElementById('home-button');

                    const initialModalBodyContent = modalBody.innerHTML;
                    const initialModalFooterContent = modalFooter.innerHTML;

                    // Add click event listener to each "Details" button
                    modalToggleButtons.forEach(function (button) {
                        button.addEventListener('click', function () {
                            // Show the modal
                            document.getElementById('drone-modal').classList.remove('hidden');
                        });
                    });

                    // Add click event listener to each "Close" button
                    modalHideButtons.forEach(function (button) {
                        button.addEventListener('click', function () {
                            // Hide the modal
                            document.getElementById('drone-modal').classList.add('hidden');
                        });
                    });

                    function reassignEventListeners() {
                        bookNowButton.addEventListener('click', function () {
                            modalBody.innerHTML = `
                <div class="bg-gray-200 text-center py-10 rounded-lg">
                    <p class="text-lg">Order Template</p>
                </div>
                `;
                            bookNowButton.style.display = 'none';
                            orderButton.style.display = 'block';
                            homeButton.style.display = 'none';
                        });

                        orderButton.addEventListener('click', function () {
                            modalBody.innerHTML = `
                <div class="bg-gray-200 text-center py-10 rounded-lg">
                    <p class="text-lg">Order Confirmation</p>
                </div>
                `;
                            orderButton.style.display = 'none';
                            homeButton.style.display = 'block';
                        });

                        homeButton.addEventListener('click', function () {
                            window.location.href = '/map';
                        });
                    }

                    modalToggleButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const targetModalId = button.getAttribute('data-modal-target');
                            const targetModal = document.getElementById(targetModalId);
                            if (targetModal) {
                                targetModal.classList.remove('hidden');
                                targetModal.classList.add('flex');
                            }
                        });
                    });

                    modalHideButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const targetModalId = button.getAttribute('data-modal-hide');
                            const targetModal = document.getElementById(targetModalId);
                            if (targetModal) {
                                targetModal.classList.add('hidden');
                                targetModal.classList.remove('flex');
                                // Reset modal content to initial state
                                modalBody.innerHTML = initialModalBodyContent;
                                modalFooter.innerHTML = initialModalFooterContent;
                                // Reassign event listeners after resetting content
                                reassignEventListeners();
                            }
                        });
                    });

                    // Initial assignment of event listeners
                    reassignEventListeners();
                });
            </script>
            </body>

            </html>