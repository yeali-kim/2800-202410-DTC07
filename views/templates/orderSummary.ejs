<!-- Style dialog -->
<style>
    #closeModal {
        background-color: transparent;
        border: none;
    }

    input {
        border: 1px solid gray;
        border-radius: 5px;
        padding: 8px;
        font-size: small;
    }

    dialog > div {
        width: 100%;
        display: flex;
        justify-content: end;
    }

    form {
        display: flex;
        flex-direction: column;
        gap: 50px;
    }

    form > button {
        align-self: center;
        width: 30%;
        background-color: rgb(29 78 216);
        color: white;
        padding: 12px;
        border-radius: 999px;
        border: none;
    }

    form > button:hover {
        background-color: rgb(37 99 235);
    }

    form > div {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        gap: 30px;
    }

    section {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    #input {
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex-basis: 60%;
    }

    #orderSummary {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-basis: 40%;
        border-left: 2px solid black;
        padding: 0px 20px;
    }

    .inputField {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .rowDiv {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        gap: 15px;
    }

    .checkbox {
        font-size: smaller;
    }

    p {
        font-size: medium;
    }

    .orderDetails {
        width: 100%;
    }

    .totalCost {
        color: darkred;
        padding: 10px;
        border-top: 1px solid darkred;
    }

    h3 {
        color: #515f84;
    }

    .user {
        display: none;
    }
</style>

<!-- Dialog (hidden) -->
<dialog id="orderDialog">
    <div>
        <input
            type="text"
            class="user"
            id="userAddress"
            value="<%= user.address %>"
            disabled />
        <input
            type="text"
            name="email"
            class="user"
            id="userEmail"
            value="<%= user.email %>"
            disabled />
        <button onclick="orderDialog.close()" id="closeModal">
            <span class="material-symbols-outlined"> close </span>
        </button>
    </div>
    <form action="/order" method="post">
        <div>
            <div id="input">
                <section id="shippingAddress">
                    <h3>Shipping Address</h3>
                    <div class="inputField">
                        <label for="address">Address</label>
                        <input
                            type="text"
                            name="address"
                            id="address"
                            placeholder="Address"
                            required />
                    </div>
                    <% if (user.address == "Add your address") { %>
                    <div>
                        <input type="checkbox" name="setAddress" />
                        <label for="setAddress" class="checkbox"
                            >make this my default address</label
                        >
                    </div>
                    <% } else { %>
                    <div>
                        <input
                            type="checkbox"
                            name="setAddress"
                            onclick="useDefaultAddress(this)" />
                        <label for="setAddress" class="checkbox"
                            >use my default address</label
                        >
                    </div>
                    <% } %>
                </section>
                <section id="paymentMethod">
                    <h3>Payment Method</h3>
                    <div class="inputField">
                        <label for="cardNumber">Card Number</label>
                        <input
                            type="text"
                            inputmode="numeric"
                            pattern="[0-9\s]{13,19}"
                            autocomplete="cc-number"
                            maxlength="19"
                            name="cardNumber"
                            placeholder="Card Number"
                            required />
                    </div>
                    <div class="rowDiv">
                        <div class="inputField">
                            <label for="expiryDate"> Expiry Date </label>
                            <input
                                type="text"
                                inputmode="numeric"
                                name="expiryDate"
                                placeholder="MM/YY"
                                maxlength="5"
                                required />
                        </div>
                        <div class="inputField">
                            <label for="securityCode">Security Code</label>
                            <input
                                type="text"
                                name="securityCode"
                                inputmode="numeric"
                                placeholder="CVV 3-4 digits"
                                minlength="3"
                                maxlength="4"
                                required />
                        </div>
                    </div>
                    <div class="inputField">
                        <label for="cardName">Name on card</label>
                        <input
                            type="text"
                            name="cardName"
                            placeholder="First and last name"
                            required />
                    </div>
                </section>
            </div>
            <section id="orderSummary">
                <h3>Order Summary</h3>
                <div class="orderDetails">
                    <p>
                        <b>Model: </b><span id="model"><%= drone.model %></span>
                    </p>
                    <p><b>Type: </b><span id="type"><%= drone.type %></span></p>
                    <p>
                        <b>Price: </b><span id="price"><%= drone.price %></span>
                    </p>
                </div>
                <h4 class="totalCost">
                    Order Total: <span><%= drone.price %></span>
                </h4>
            </section>
        </div>
        <button type="submit">Order</button>
    </form>
</dialog>

<!-- Javascript for the dialog -->
<script>
    order.addEventListener("click", function () {
        orderDialog.showModal();
    });

    function useDefaultAddress(element) {
        if (element.checked) {
            address.value = userAddress.innerText;
            address.disabled = true;
            address.style.backgroundColor = "lightgray";
        } else {
            address.disabled = false;
            address.style.backgroundColor = "white";
        }
    }
</script>
